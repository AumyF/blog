export const metadata = {
  title:
    "作った: dotstingray - Dhallで書けるdotfiles、もしくはDhallによるタスクランナーという可能性",
  description:
    "dotfilesを管理するためにはシェルスクリプトを使うことが多いが、できることならあまり書きたくはない。そこで、静的片付け設定言語であるDhallを使って書けるようにした。",
};

あなたは **dotfiles** を持っているだろうか？知らない読者のために簡単に説明しておくと、

では、さっそくわたしの作った dotfiles manager を紹介したい。名前は dotstingray という。

# dotstingray の機能

dotstingray は CLI アプリケーションである。使い方は

```
dotstingray --recipe ./foo.dhall
```

というもの。ここで `./foo.dhall` は実行すべきコマンドを記した Dhall ファイルで、レシピと呼んでいる。レシピの中身はこのようになっている。

```dhall
let Recipe = { commands : List Text }

let copy = \(arg : { from : Text, dest : Text }) -> "cp ${arg.from} ${arg.dest}"

let cp-fish =
      \(from : Text) -> copy { from, dest = "~/.config/fish/config.fish" }

let cp-starship =
      \(from : Text) -> copy { from, dest = "~/.config/starship.toml" }

let cp-gitconfig = \(from : Text) -> copy { from, dest = "~/.gitconfig" }

let cp-yabairc = \(from : Text) -> copy { from, dest = "~/.yabairc" }

let cp-skhdrc = \(from : Text) -> copy { from, dest = "~/.skhdrc" }

in    { commands =
        [ cp-starship "./starship.toml"
        , cp-fish "./config.fish"
        , cp-gitconfig "./.gitconfig"
        , cp-yabairc "./.yabairc"
        , cp-skhdrc "./.skhdrc"
        ]
      }
    : Recipe
```

# シェルスクリプトを書かない

さて、ここで dotfiles をいかようにして導入するかという点が重要になる。なお、dotfiles を導入する環境はほとんど何も入っていないバニラの環境であることに留意する必要がある。つまり、Ruby や Python, Node.js といったインタプリタがそのままでは実行できない可能性が高い。そのため、dotfiles を導入するためのツールは

- シェルスクリプト
- シングルバイナリ

のどちらかに絞られることになる (シェルが入っていない環境については考えないものとする)。

シェルスクリプトでは `cp ./.zshrc ~/.zshrc` のようにコマンドが直接書ける。しかし、シェルスクリプトには明らかな問題がある: 書きづらい。`[` などの記号らしき物体がなぜかコマンドとしてはたらき、終了コードで条件分岐し、`if` を `fi` で閉じる、などの難解で関わりたくない仕様が数多くある。そもそもあらゆるデータが文字列であり動的型付けですらない。人はいつまでこんな言語を書いていなければならないのか。

そのようなわけでわたしはシングルバイナリを用意する方を選んだ。

# Dhall

シングルバイナリではいろいろな管理手法が取れる。その中でも
